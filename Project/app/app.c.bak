/*
*********************************************************************************************************
*
*	模块名称 : ASP模块(For STM32F4XX)
*	文件名称 : asp.c
*	版    本 : V1.0
*	说    明 : 
*
*********************************************************************************************************
*/

#include "app.h"
#include "main.h"

WORK_MODE Sys_Work_Mode = SYS_POWER_ON;

/*
*********************************************************************************************************
*	函 数 名: app_Hook
*	功能说明: app 相关调试，测试钩子函数
*	形    参：无
*	返 回 值: 无
*********************************************************************************************************
*/
void app_Hook(void)
{
  static uint32_t sys_time, time_ms = 0, time_add_up = 0;
	DISABLE_INT();  	/* 关中断 */
	sys_time = Sys_Time;	/* 这个变量在Systick中断中被改写，因此需要关中断进行保护 */
	ENABLE_INT();  		/* 开中断 */
	
	if(time_ms != sys_time)
	{
		time_ms = sys_time;
		if(++time_add_up >= 1000)
		{
				time_add_up = 0;

		}
	}
}

/*
*********************************************************************************************************
*	函 数 名: App_Init
*	功能说明: 
*	形    参：无
*	返 回 值: 无
*********************************************************************************************************
*/
void App_Init(void)
{
	printer_Init();//打印机相关初始化
	pa1100_Init();//磁头服相关初始化
	//esam8810_Init();//ESAM加密芯片相关初始化
	psam_card_Init();
}

/*
*********************************************************************************************************
*	函 数 名: App_Task
*	功能说明: 
*	形    参：无
*	返 回 值: 无
*********************************************************************************************************
*/
void App_Task(void)
{
	app_Hook();//调用钩子函数
	uart_SERVER_TASK();//串口检查服务函数
	printer_SERVER_TASK();//打印服务函数
	pa1100_SERVER_TASK();//磁头服务函数
	esam8810_SERVER_TASK();//ESAM加密芯片服务函数
	psam_card_SERVER_TASK();
}

